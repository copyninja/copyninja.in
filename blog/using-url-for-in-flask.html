<!DOCTYPE html><html lang="en"><head><link href="https://fonts.googleapis.com/css?family=Cantarell" rel="stylesheet"><title>Note to Self: How to use url_for in Flask application</title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="https://copyninja.in/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Random Ramblings Full Atom Feed"><link href="https://copyninja.in/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Random Ramblings Categories Atom Feed"><link rel="stylesheet" type="text/css" href="/theme/css/pygments.css"><link rel="stylesheet" type="text/css" href="/theme/css/default.css"><meta name="tags" content="python"><meta name="tags" content="programming"><meta name="tags" content="flask"><meta name="tags" content="webapp"><meta name="tags" content="notetoself"></head><body><div id="header" class="body"><div id="navigation"> | <a href="https://copyninja.in">Home</a> | | <a href="https://copyninja.in/about">About</a> | | <a href="https://copyninja.in/contact">Contact</a> | | <a href="https://copyninja.in/categories.html">Categories</a> | | <a href="https://copyninja.in/tags.html">Tags</a> | </div><h1><a href="https://copyninja.in/blog/using-url-for-in-flask.html">Note to Self: How to use url_for in Flask application</a></h1></div><div id="content"><section id="content" class="body"><footer class="post-info"><p> Posted on May 02, 2014 By copyninja under development </p></abbr></footer><div class="entry-content"><p><cite>url_for</cite> is normally used to avoid hard coding of URL in Flask based webapps. I've been using it in SILPA <a class="reference external" href="https://github.com/Project-SILPA/Silpa-Flask">port</a> written using Flask by. But this was written long back and written as POC to show for Santhosh author of SILPA app which even managed to go into production :-). Recently I started organizing the code and started using <cite>flask.Blueprint</cite> which was previously written using <cite>flask.views.MethodView</cite> class and here I started facing problem with old templates. I'm just gonna explain what is the difference when using url_for with <cite>MethodView</cite> and <cite>Blueprint</cite>.</p><p>Lets have some sample code for <cite>MethodView</cite> first, this code is from <cite>Flask</cite> documentation.</p><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask.views</span> <span class="kn">import</span> <span class="n">MethodView</span>

<span class="k">class</span> <span class="nc">UserAPI</span><span class="p">(</span><span class="n">MethodView</span><span class="p">):</span>

       <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
           <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
           <span class="o">...</span>

       <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
           <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">from_form_data</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
           <span class="o">...</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">UserAPI</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">))</span>
</pre></div><p>Here we have a view which is derived from <cite>MethodView</cite> which has logic on how to handle the requests. We use <cite>add_url_rule</cite> to register rule to handle <cite>/users/</cite> url end point and we pass the class as view function which is done by <cite>as_view</cite> class method and we can refer this method in our Jinja2 templates using name <cite>users</cite>. So a statement like</p><div class="highlight"><pre><span></span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
</pre></div><p>in our templates will be converted to <cite>/users/</cite> URL when page is rendered to client by Flask.</p><p>Now when I replaced the <cite>MethodView</cite> in favor of <cite>Blueprint</cite> I started getting up <cite>werkzeug.routing.BuildError</cite> thrown on my face and I had no clue why!. Yeah I know I'm bad at reading documentation but even after reading documentation I was still thinking that</p><div class="highlight"><pre><span></span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</pre></div><p>should return me a proper URL and I was wondering why its failing. Finally after re-reading documentation for <cite>url_for</cite> it was becoming clear to me, <cite>url_for</cite> definition looks like below</p><div class="highlight"><pre><span></span><span class="n">flask</span><span class="o">.</span><span class="n">url_for</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="o">**</span><span class="n">values</span><span class="p">)</span>
</pre></div><p>Here <cite>endpoint</cite> is actually a function which is supposed to be serving the URL and <cite>**values</cite> is the arguments for this function. The URL in question should be defined in python code using decorator. In my case following is the new function serving the web pages for SILPA.</p><div class="highlight"><pre><span></span><span class="n">bp</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;frontend&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">_BASE_URL</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="s1">&#39;index.html&#39;</span><span class="p">})</span>
<span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">_BASE_URL</span> <span class="o">+</span> <span class="s1">&#39;&lt;page&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">serve_pages</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
       <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="s2">&quot;index.html&quot;</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;SILPA&#39;</span><span class="p">,</span>
                               <span class="n">main_page</span><span class="o">=</span><span class="n">_BASE_URL</span><span class="p">,</span>
                               <span class="n">modules</span><span class="o">=</span><span class="n">_modulename_to_display</span><span class="p">)</span>
       <span class="k">elif</span> <span class="n">page</span> <span class="o">==</span> <span class="s2">&quot;License&quot;</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;license.html&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;SILPA License&#39;</span><span class="p">,</span>
                                <span class="n">main_page</span><span class="o">=</span><span class="n">_BASE_URL</span><span class="p">,</span>
                                <span class="n">modules</span><span class="o">=</span><span class="n">_modulename_to_display</span><span class="p">)</span>
       <span class="k">elif</span> <span class="n">page</span> <span class="o">==</span> <span class="s2">&quot;Credits&quot;</span><span class="p">:</span>
           <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;credits.html&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Credits&#39;</span><span class="p">,</span>
                                <span class="n">main_page</span><span class="o">=</span><span class="n">_BASE_URL</span><span class="p">,</span>
                                <span class="n">modules</span><span class="o">=</span><span class="n">_modulename_to_display</span><span class="p">)</span>
       <span class="k">elif</span> <span class="n">page</span> <span class="o">==</span> <span class="s2">&quot;Contact&quot;</span><span class="p">:</span>
           <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;contact.html&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Contact SILPA Team&#39;</span><span class="p">,</span>
                                <span class="n">main_page</span><span class="o">=</span><span class="n">_BASE_URL</span><span class="p">,</span>
                                <span class="n">modules</span><span class="o">=</span><span class="n">_modulename_to_display</span><span class="p">)</span>
       <span class="k">else</span><span class="p">:</span>
           <span class="c1"># modules requested!.</span>
           <span class="k">if</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">_display_module_map</span><span class="p">:</span>
               <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="n">_display_module_map</span><span class="p">[</span><span class="n">page</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span><span class="p">,</span>
                                    <span class="n">title</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">main_page</span><span class="o">=</span><span class="n">_BASE_URL</span><span class="p">,</span>
                                    <span class="n">modules</span><span class="o">=</span><span class="n">_modulename_to_display</span><span class="p">)</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="c1"># Did we encounter something which is not registered by us?</span>
               <span class="k">return</span> <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</pre></div><p>You can ignore function code but just note the decorators, here I'm registering the function <cite>serve_pages</cite> with <cite>page</cite> as argument for URL patterns <cite>/</cite> and <cite>/&lt;page&gt;</cite>, <cite>_BASE_URL</cite> here is mount point of application it can be just <cite>/</cite> or <cite>/mountpoint</cite> depending on that URL registered changes. Now I need to modify code for all <cite>url_for</cite> in my template to look like below</p><div class="highlight"><pre><span></span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;.serve_pages&#39;</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="s1">&#39;/License&#39;</span><span class="p">)</span> <span class="c1"># for /License</span>
<span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;.serve_pages&#39;</span><span class="p">)</span> <span class="c1"># which will turn in to /index.html</span>
</pre></div><p>The <cite>.</cite> in front of function is for referring current Blueprint, in my case the Flask will consider it as <cite>frontend.serve_pages</cite> as function name and generates appropriate URL at run time.</p><p>So my fault was misunderstanding <cite>endpoint</cite> argument as URL endpoint but where as its actually function name supposed to serve the page. But when using MethodViews I can simply convert class to a function with my preferred name just like <cite>UserAPI.as_view('/')</cite> so <cite>url_for('/')</cite> just works.</p></div><div id="footer"><p><italic>Tagged as: flask, notetoself, programming, python, webapp, </italic></p></section></div><hr><div id="footer"> Site Proudly powered by <a href="http://getpelican.com/">Pelican</a></div></body></html>