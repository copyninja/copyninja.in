<!DOCTYPE html><html lang="en"><head><link href="https://fonts.googleapis.com/css?family=Cantarell" rel="stylesheet"><title>SPAKE2 In Golang: Journey to Cryptoland begins</title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="https://copyninja.in/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Random Ramblings Full Atom Feed"><link href="https://copyninja.in/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Random Ramblings Categories Atom Feed"><link rel="stylesheet" type="text/css" href="/theme/css/pygments.css"><link rel="stylesheet" type="text/css" href="/theme/css/default.css"><meta name="tags" content="go"><meta name="tags" content="golang"><meta name="tags" content="spake2"><meta name="tags" content="cryptography"><meta name="tags" content="ecc"><meta name="tags" content="magic-wormhole"></head><body><div id="header" class="body"><div id="navigation"> | <a href="https://copyninja.in">Home</a> | | <a href="https://copyninja.in/about">About</a> | | <a href="https://copyninja.in/contact">Contact</a> | | <a href="https://copyninja.in/categories.html">Categories</a> | | <a href="https://copyninja.in/tags.html">Tags</a> | </div><h1><a href="https://copyninja.in/blog/golang_spake2_1.html">SPAKE2 In Golang: Journey to Cryptoland begins</a></h1></div><div id="content"><section id="content" class="body"><footer class="post-info"><p> Posted on Jul 22, 2018 By copyninja under development </p></abbr></footer><div class="entry-content"><blockquote> This or the series of SPAKE2 related posts are inspired from <a class="reference external" href="https://jml.io">Jonathan Lange's</a> <a class="reference external" href="https://jml.io/tag/spake2.html">series on SPAKE2</a> when he ported it to Haskell, which is also the reference I used for my implementation in Golang.</blockquote><div class="section" id="brief-background"><h2>Brief Background</h2><p>Before I can go to detail I should tell why/how I came to implementing SPAKE2 in Golang. Story starts a couple of month back when I started contributing to <a class="reference external" href="https://github.com/warner/magic-wormhole.rs">*magic-wormhole.rs*</a>, a Rust port of original Python project of magic-wormhole. You can read <a class="reference external" href="https://lwn.net/Articles/692061/">this LWN article</a> to understand more about what magic-wormhole is.</p><p>During contribution my friend <a class="reference external" href="https://rkrishnan.org/">Ramakrishnan Muthukrishnan</a> said to me that I should try to port the magic-wormhole to Golang. I was not a expert Go programmer but had understanding of language basics and thought why not use it to improve my language understanding. And this is where it all started.</p></div><div class="section" id="what-is-spake2-why-is-it-used"><h2>What is SPAKE2 why is it used?</h2><p>At this point we need to know why SPAKE2 is needed and how magic-wormhole uses it. <a class="reference external" href="http://www.di.ens.fr/~mabdalla/papers/AbPo05a-letter.pdf">SPAKE2</a> is <em>Simple Password Authenticated Key Exchange</em> protocol. It allows 2 parties having a shared weak password to derive a strong shared key which can then be used by the parties to setup a encrypted+authenticated channel between them.</p><p><em>magic-wormhole</em> uses SPAKE2 to negotiate a shared session key between communicating parties which is then used by magic-wormhole to derive different keys needed for different <em>purpose</em>.</p><p>So I hit my first road block after agreeing to implement the <em>magic-wormhole</em> in Golang, there is no SPAKE2 implementation readily available in Go!.</p></div><div class="section" id="enter-cryptography-and-my-knowledge-about-it"><h2>Enter Cryptography and My knowledge about it</h2><p>Ram convinced me that its easy to implement SPAKE2 in Go and I agreed. But my knowledge on cryptography was limited. I knew Cryptography is</p><ul class="simple"><li>basically math with big numbers and relies on fact that factoring big prime number is hard for computers.</li><li>These big numbers are derived from <em>Abelian Group</em> and related concepts from number theory, which I have studied in academics but since I've never learnt a practical use case for them, its eating dust some where inside my memory.</li></ul><p>I've taken some theoretical course on Cryptography but never thought of implementing one myself. With these weak foundation I set out for a new adventure.</p><div class="section" id="python-spake2-implementation"><h3>Python SPAKE2 Implementation</h3><p>Since magic-wormhole is implemented in python, SPAKE2 implementation in Python is considered as reference for other language implementation. SPAKE2 paper does not specify much about where or how the requirement public constants are defined, so implementer can take liberty at defining those. Python code uses 2 groups one is <em>Twisted Edwards Curve</em> group <em>Ed25519</em> and others are multiplicative group over Integer of 1024, 2048 and 3072 bits.</p><p>In Python code Warner himself has defined Ed25519 and other Integer group and related operations. In Rust code though there is only Ed25519 group but its created using <em>curve25519-dalek</em> library. Haskell code also defines the group operations by itself instead of depending on any other libraries (possibly Cryptonite). So as a first step I started for searching any library equivalent to <em>curve25519-dalek</em> as I've no clue what is an Elliptic curve.(forget groups I don't know basic itself).</p></div><div class="section" id="first-try-bruteforce"><h3>First Try, Bruteforce</h3><p>I've this bad habit of tackling problem with brute force; some times it works but most time it just exhausts me, taking me nowhere. So with my normal habit I started looking for Ed25519 curve operations library. (Without actually knowing what operations are and how it works). I tried to read through <em>curve25519-dalek</em> but invain, nothing entered into my head. I found <em>ed25519</em> package for Go written by <em>Adam Langley</em> but eventually it turned out to be actually a signature package. I found an internal package defined in <em>ed25519</em> package called <em>edwards25519</em>, which seem to have some operations defined but I was unable to understand it nor figure out why its made internal. I later even took a dig at embedding <em>edwards25519</em> as part of my implementation of ed25519 group but finally had to drop it for my own version that story will be part of another post in this series.</p></div></div><div class="section" id="conclusion"><h2>Conclusion</h2><p>During all these I was constantly in talk with Ram and first thing he told me was to slow down a bit and go from scratch. And that's what was the learning point for me. In short I can say the following.</p><blockquote> Nothing can be done in single day, before you code understand the basic concepts and then build it from there. As they say you can't build a stable house on weak foundation.</blockquote><p>In the next post in this series I will write about my learning on Elliptic Curves and Elliptic curve groups, followed by experiment with number groups and finally learning and decision I had to make in writing <em>gospake2</em>.</p></div></div><div id="footer"><p><italic>Tagged as: cryptography, ecc, go, golang, magic-wormhole, spake2, </italic></p></section></div><hr><div id="footer"> Site Proudly powered by <a href="http://getpelican.com/">Pelican</a></div></body></html>