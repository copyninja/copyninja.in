<!DOCTYPE html><html lang="en"><head><link href="https://fonts.googleapis.com/css?family=Cantarell" rel="stylesheet"><title>Notes: LXC How-To</title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="https://copyninja.in/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Random Ramblings Full Atom Feed"><link href="https://copyninja.in/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Random Ramblings Categories Atom Feed"><link rel="stylesheet" type="text/css" href="/theme/css/pygments.css"><link rel="stylesheet" type="text/css" href="/theme/css/default.css"><meta name="tags" content="lxc"><meta name="tags" content="container"><meta name="tags" content="debian"></head><body><div id="header" class="body"><div id="navigation"> | <a href="https://copyninja.in">Home</a> | | <a href="https://copyninja.in/about">About</a> | | <a href="https://copyninja.in/contact">Contact</a> | | <a href="https://copyninja.in/categories.html">Categories</a> | | <a href="https://copyninja.in/tags.html">Tags</a> | </div><h1><a href="https://copyninja.in/blog/lxc_howto.html">Notes: LXC How-To</a></h1></div><div id="content"><section id="content" class="body"><footer class="post-info"><p> Posted on Dec 26, 2014 By copyninja under devops </p></abbr></footer><div class="entry-content"><p>LXC - Linux Containers allows us to run multiple isolated Linux system under same control host. This will be useful for testing application without changing our existing system.</p><p>To create an LXC container we use the <cite>lxc-create</cite> command, it can accepts the template option, with which we can choose the OS we would like to run under the virtual isolated environment. On a Debian system I see following templates supported</p><div class="highlight"><pre><span></span><span class="o">[</span>vasudev@rudra:<span class="w"> </span>~/<span class="w"> </span><span class="o">]</span>%<span class="w"> </span>ls<span class="w"> </span>/usr/share/lxc/templates
lxc-alpine*<span class="w">    </span>lxc-archlinux*<span class="w">  </span>lxc-centos*<span class="w">  </span>lxc-debian*<span class="w">    </span>lxc-fedora*<span class="w">  </span>lxc-openmandriva*<span class="w">  </span>lxc-oracle*<span class="w">  </span>lxc-sshd*<span class="w">    </span>lxc-ubuntu-cloud*
lxc-altlinux*<span class="w">  </span>lxc-busybox*<span class="w">    </span>lxc-cirros*<span class="w">  </span>lxc-download*<span class="w">  </span>lxc-gentoo*<span class="w">  </span>lxc-opensuse*<span class="w">      </span>lxc-plamo*<span class="w">   </span>lxc-ubuntu*
</pre></div><p>For my application testing I wanted to create a Debian container for my By default the template provided by lxc package creates Debian stable container. This can be changed by passing the option to debootstrap after <cite>--</cite> as shown below.</p><div class="highlight"><pre><span></span>sudo<span class="w"> </span><span class="nv">MIRROR</span><span class="o">=</span>http://localhost:9999/debian<span class="w"> </span>lxc-create<span class="w"> </span>-t<span class="w"> </span>debian<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-f<span class="w">   </span>container.conf<span class="w"> </span>-n<span class="w"> </span>container-name<span class="w"> </span>--<span class="w"> </span>-r<span class="w"> </span>sid
</pre></div><p><cite>-r</cite> switch is used to specify the release, MIRROR environment variable is used to choose the required Debian mirror. I wanted to use my own local <em>approx</em> installation, so I can save some bandwidth.</p><p><cite>container.conf</cite> is the configuration file used for creating the LXC, in my case it contains basic information on how container networking should b setup. The configuration is basically taken from <a class="reference external" href="https://wiki.debian.org/LXC">LXC Debian wiki</a></p><div class="highlight"><pre><span></span><span class="na">lxc.utsname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">aptoffline-dev</span>
<span class="na">lxc.network.type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">veth</span>
<span class="na">lxc.network.flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">up</span>
<span class="na">lxc.network.link</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">br0.1</span>
<span class="na">lxc.network.name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">eth0</span>
<span class="na">lxc.network.ipv4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">192.168.3.2/24</span>
<span class="na">lxc.network.veth.pair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">vethvm1</span>
</pre></div><p>I'm using VLAN setup described in <a class="reference external" href="https://wiki.debian.org/LXC/VlanNetworking">Debian wiki: LXC VLAN Networking</a> page. Below is my <cite>interfaces</cite> file.</p><pre class="literal-block">
iface eth0.1 inet manual

iface br0.1  inet manual
   bridge_ports eth0.1
   bridge_fd 0
   bridge_maxwait 0
</pre><p>Before launching the LXC make sure you run below command</p><div class="highlight"><pre><span></span>sudo<span class="w"> </span>ifup<span class="w"> </span>eth0.1
sudo<span class="w"> </span>ifup<span class="w"> </span>br0.1

<span class="c1"># Also give ip to bridge in same subnet as lxc.network.ipv4</span>
sudo<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>add<span class="w"> </span><span class="m">192</span>.168.3.1/24<span class="w"> </span>dev<span class="w"> </span>br0.1
</pre></div><p>I'm giving ip address to bridge so that I can communicate with container from my control host, once it comes up.</p><p>Now start the container using below command</p><div class="highlight"><pre><span></span>sudo<span class="w"> </span>lxc-start<span class="w"> </span>-n<span class="w"> </span>container<span class="w"> </span>-d<span class="w"> </span>-c<span class="w"> </span>tty8
</pre></div><p>We are starting lxc in daemon mode and attaching it to console <cite>tty8</cite>. If you want, you can drop -d and -c option to start lxc in foreground. But its better you start it in background and attach using <cite>lxc-console</cite> command shown below.</p><div class="highlight"><pre><span></span>sudo<span class="w"> </span>lxc-console<span class="w"> </span>-n<span class="w"> </span>container<span class="w"> </span>-t<span class="w"> </span>tty8
</pre></div><p>You can detach from console using <cite>Ctrl+a q</cite> combination and let lxc execute in background.</p><p>Its also possible to simply ssh into the running container since we have enabled networking.</p><p>Stopping the container should be done using <cite>lxc-stop</cite> command, but without <cite>-k</cite> switch (kill) this command never returned. Even with timeout container is not stopped.</p><div class="highlight"><pre><span></span>sudo<span class="w"> </span>lxc-stop<span class="w"> </span>-n<span class="w"> </span>container
</pre></div><p><cite>-r</cite> can be used for reboot of container. Since I couldn't get clean shutdown I normally attach the console and issue a <cite>halt</cite> command in container itself. Not sure if this is the right way, but it gets the thing done.</p><p>I consider Linux container as a better alternative for spawning a virtual Linux environment instead of running a full blown VM like Virtualbox or VMware.</p></div><div id="footer"><p><italic>Tagged as: container, debian, lxc, </italic></p></section></div><hr><div id="footer"> Site Proudly powered by <a href="http://getpelican.com/">Pelican</a></div></body></html>