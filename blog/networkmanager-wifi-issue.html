<!DOCTYPE html><html lang="en"><head><link href="https://fonts.googleapis.com/css?family=Cantarell" rel="stylesheet"><title>Stop messing with my settings Network Manager</title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="https://copyninja.in/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Random Ramblings Full Atom Feed"><link href="https://copyninja.in/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Random Ramblings Categories Atom Feed"><link rel="stylesheet" type="text/css" href="/theme/css/pygments.css"><link rel="stylesheet" type="text/css" href="/theme/css/default.css"><meta name="tags" content="network-manager"><meta name="tags" content="ath9k"><meta name="tags" content="wifi"></head><body><div id="header" class="body"><div id="navigation"> | <a href="https://copyninja.in">Home</a> | | <a href="https://copyninja.in/about">About</a> | | <a href="https://copyninja.in/contact">Contact</a> | | <a href="https://copyninja.in/categories.html">Categories</a> | | <a href="https://copyninja.in/tags.html">Tags</a> | </div><h1><a href="https://copyninja.in/blog/networkmanager-wifi-issue.html">Stop messing with my settings Network Manager</a></h1></div><div id="content"><section id="content" class="body"><footer class="post-info"><p> Posted on Jul 20, 2014 By copyninja under misc </p></abbr></footer><div class="entry-content"><p>I use a laptop with <cite>Atheros</cite> wifi card with <cite>ath9k</cite> driver. I use <cite>hostapd</cite> to convert my laptop wifi into AP (Access point) so I can share network with my <cite>Nexus 7</cite> and <cite>Kindle</cite>. This has been working fine for quite some time till my recent update.</p><p>After recent system update (I use Debian Sid), I couldn't for some reason convert my wifi into AP so my device can connect. I can't find anything in log nor in hostapd debug messages which is useful to trouble shoot the issue. Every time I start the laptop my wifi card will be blocked by RF-KILL and I have manually unblock (both hard and soft). The script which I use to convert my Wifi into AP is below</p><div class="highlight"><pre><span></span>#Initial wifi interface configuration
ifconfig &quot;$1&quot; up 192.168.2.1 netmask 255.255.255.0
sleep 2

# start dhcp
sudo systemctl restart dnsmasq.service

iptables --flush
iptables --table nat --flush
iptables --delete-chain
iptables -t nat -A POSTROUTING -o &quot;$2&quot; -j MASQUERADE
iptables -A FORWARD -i &quot;$1&quot; -j ACCEPT

sysctl -w net.ipv4.ip_forward=1

#start hostapd
hostapd /etc/hostapd/hostapd.conf  &amp;&gt; /dev/null &amp;
</pre></div><p>I tried rebooting the laptop and for some time I managed to convert my wifi into AP, I noticed at same time that Network Manager is not started once laptop is booted, yeah this also started happening after recent upgrade which I guess is the black magic of systemd. After some time I noticed wifi has went down and now I can't bring it up because its blocked by RF-KILL. After checking the syslog I noticed following lines.</p><pre class="literal-block">
Jul 18 23:09:30 rudra kernel: [ 1754.891060] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
Jul 18 23:09:30 rudra NetworkManager[5485]: &lt;info&gt; (mon.wlan0): using nl80211 for WiFi device control
Jul 18 23:09:30 rudra NetworkManager[5485]: &lt;info&gt; (mon.wlan0): driver supports Access Point (AP) mode
Jul 18 23:09:30 rudra NetworkManager[5485]: &lt;info&gt; (mon.wlan0): new 802.11 WiFi device (driver: 'ath9k' ifindex: 10)
Jul 18 23:09:30 rudra NetworkManager[5485]: &lt;info&gt; (mon.wlan0): exported as /org/freedesktop/NetworkManager/Devices/8
Jul 18 23:09:30 rudra NetworkManager[5485]: &lt;info&gt; (mon.wlan0): device state change: unmanaged -&gt; unavailable (reason 'managed') [10 20 2]
Jul 18 23:09:30 rudra NetworkManager[5485]: &lt;info&gt; (mon.wlan0): preparing device
Jul 18 23:09:30 rudra NetworkManager[5485]: &lt;info&gt; devices added (path: /sys/devices/pci0000:00/0000:00:1c.1/0000:04:00.0/net/mon.wlan0, iface: mon.wlan0)
Jul 18 23:09:30 rudra NetworkManager[5485]: &lt;info&gt; device added (path: /sys/devices/pci0000:00/0000:00:1c.1/0000:04:00.0/net/mon.wlan0, iface: mon.wlan0): no ifupdown configuration found.
Jul 18 23:09:33 rudra ModemManager[891]: &lt;warn&gt;  Couldn't find support for device at '/sys/devices/pci0000:00/0000:00:1c.1/0000:04:00.0': not supported by any plugin
</pre><p>Well I couldn't figure out much but it looks like NetworkManager has come up and after seeing interface <cite>mon.wlan0</cite>, a monitoring interface created by <cite>hostapd</cite> to monitor the AP goes mad and tries to do something with it. I've no clue what it is doing and don't have enough patience to debug that. Probably some expert can give me hints on this.</p><p>So as a last resort I purged the NetworkManager completely from the system and settled back to good old <cite>wicd</cite> and rebooted the system. After reboot wifi card is happy and is not blocked by RF-KILL and now I can convert it AP and use it as long as I wish without any problems. Wicd is not a great tool but its good enough to get the job done and does only what is asked to it unlike the NetworkManager.</p><p>So in short</p><blockquote> NetworkManager please stop f***ing with my settings and stop acting oversmart.</blockquote></div><div id="footer"><p><italic>Tagged as: ath9k, network-manager, wifi, </italic></p></section></div><hr><div id="footer"> Site Proudly powered by <a href="http://getpelican.com/">Pelican</a></div></body></html>